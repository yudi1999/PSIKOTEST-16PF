<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Psikotes Big Five Personality</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .card {
            background-color: white;
            border-radius: 1.5rem;
            padding: 2.5rem;
            box-shadow: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            transition: all 0.3s ease-in-out;
        }
        .form-input {
            width: 100%;
            border-radius: 0.75rem;
            border: 1px solid #D1D5DB;
            padding: 0.75rem 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        .form-input:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        .btn-primary {
            background-color: #3B82F6;
            color: white;
            font-weight: 600;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            transition: background-color 0.3s, transform 0.2s;
            border: none;
            cursor: pointer;
        }
        .btn-primary:hover {
            background-color: #2563EB;
            transform: translateY(-2px);
        }
        .btn-primary:disabled {
            background-color: #9CA3AF;
            cursor: not-allowed;
            transform: none;
        }
        .question-item {
            border: 1px solid #E5E7EB;
            border-radius: 1rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            background-color: #F9FAFB;
        }
        .radio-label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            transition: background-color 0.2s, color 0.2s;
            border: 1px solid transparent;
        }
        .radio-label:hover {
            background-color: #EFF6FF;
        }
        input[type="radio"]:checked + .radio-label {
            background-color: #DBEAFE;
            color: #1E40AF;
            font-weight: 600;
            border-color: #3B82F6;
        }
        input[type="radio"] {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">

    <div class="max-w-4xl w-full mx-auto">
        <!-- Halaman Data Diri -->
        <div id="welcome-page" class="card">
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800">Selamat Datang di Psikotes Online</h1>
                <p class="text-gray-600 mt-2">Tes Kepribadian Big Five untuk Seleksi Kandidat</p>
            </div>
            <form id="personal-data-form">
                <h2 class="text-2xl font-semibold text-gray-700 mb-6">Lengkapi Data Diri Anda</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                    <div>
                        <label for="fullName" class="block text-gray-700 font-medium mb-2">Nama Lengkap</label>
                        <input type="text" id="fullName" name="fullName" class="form-input" required>
                    </div>
                    <div>
                        <label for="gender" class="block text-gray-700 font-medium mb-2">Jenis Kelamin</label>
                        <select id="gender" name="gender" class="form-input" required>
                            <option value="">Pilih Jenis Kelamin</option>
                            <option value="Laki-laki">Laki-laki</option>
                            <option value="Perempuan">Perempuan</option>
                        </select>
                    </div>
                    <div>
                        <label for="education" class="block text-gray-700 font-medium mb-2">Pendidikan Terakhir</label>
                        <input type="text" id="education" name="education" class="form-input" required>
                    </div>
                    <div>
                        <label for="dob" class="block text-gray-700 font-medium mb-2">Tanggal Lahir</label>
                        <input type="date" id="dob" name="dob" class="form-input" required>
                    </div>
                </div>

                <div class="mt-8">
                    <h3 class="text-xl font-semibold text-gray-700 mb-4">Persetujuan</h3>
                    <div class="flex items-start">
                        <input type="checkbox" id="consent" name="consent" class="h-5 w-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500 mt-1" required>
                        <label for="consent" class="ml-3 text-gray-700">
                            Saya setuju bahwa data yang saya berikan akan digunakan untuk keperluan proses seleksi. Saya memahami bahwa hasil tes ini akan dijaga kerahasiaannya dan hanya akan digunakan oleh pihak perusahaan untuk tujuan evaluasi.
                        </label>
                    </div>
                </div>

                <div class="text-center mt-10">
                    <button type="submit" id="start-test-btn" class="btn-primary w-full md:w-auto" disabled>Mulai Tes</button>
                </div>
            </form>
        </div>

        <!-- Halaman Tes -->
        <div id="test-page" class="card hidden">
            <h1 class="text-3xl font-bold text-gray-800 text-center mb-2">Tes Kepribadian</h1>
            <p class="text-gray-600 text-center mb-8">Pilih jawaban yang paling sesuai dengan diri Anda.</p>
            <form id="test-form">
                <div id="questions-container"></div>
                <div class="text-center mt-10">
                    <button type="submit" id="submit-btn" class="btn-primary w-full md:w-auto">Kirim Jawaban</button>
                </div>
            </form>
        </div>

        <!-- Halaman Hasil -->
        <div id="result-page" class="card hidden text-center">
             <div id="loading-spinner" class="hidden my-8">
                <svg class="animate-spin h-16 w-16 text-blue-600 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <p class="text-lg text-gray-600 mt-4">Sedang memproses hasil Anda...</p>
            </div>
            <div id="result-content">
                <svg class="w-24 h-24 mx-auto text-green-500 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                <h1 class="text-4xl font-bold text-gray-800">Terima Kasih!</h1>
                <p class="text-gray-600 mt-4 text-lg">Anda telah berhasil menyelesaikan tes. Hasil tes Anda telah dikirimkan ke email rekruter untuk proses selanjutnya.</p>
                <p class="text-gray-500 mt-2">Semoga berhasil dalam proses seleksi!</p>
            </div>
        </div>
    </div>

    <script>
        // Data dari file yang Anda berikan
        const questions = [
            { id: 1, text: "Aktif Berbicara" },
            { id: 2, text: "Mencari Kelemahan Orang Lain" },
            { id: 3, text: "Mengerjakan Tugas dengan Serius" },
            { id: 4, text: "Merasa Tertekan" },
            { id: 5, text: "Orang Unik yang Penuh dengan Gagasan Baru" },
            { id: 6, text: "Suka Menyendiri" },
            { id: 7, text: "Suka Menolong dan Tidak Iri pada Orang Lain" },
            { id: 8, text: "Bertindak Asal-asalan" },
            { id: 9, text: "Orang yang Santai dan Mampu Mengatasi Stres" },
            { id: 10, text: "Memiliki Rasa Ingin Tahu Terhadap Sesuatu yang Berbeda" },
            { id: 11, text: "Memiliki Banyak Energi" },
            { id: 12, text: "Suka Berdebat dengan Orang Lain" },
            { id: 13, text: "Dapat Diandalkan" },
            { id: 14, text: "Mudah Cemas" },
            { id: 15, text: "Cerdas dan Mampu Berpikir Mendalam" },
            { id: 16, text: "Menghasilkan Banyak Antusiasme" },
            { id: 17, text: "Pemaaf" },
            { id: 18, text: "Cenderung Tidak Terorganisir" },
            { id: 19, text: "Mudah Khawatir" },
            { id: 20, text: "Memiliki Imajinasi yang Aktif" },
            { id: 21, text: "Cenderung Pendiam" },
            { id: 22, text: "Secara Umum Dapat Dipercaya" },
            { id: 23, text: "Cenderung Pemalas" },
            { id: 24, text: "Memiliki Perasaan yang Stabil dan Tidak Mudah Sedih" },
            { id: 25, text: "Kreatif" },
            { id: 26, text: "Terbuka" },
            { id: 27, text: "Dingin dan Kurang Bersahabat" },
            { id: 28, text: "Dapat Memusatkan Diri Pada Pekerjaan" },
            { id: 29, text: "Dipengaruhi Oleh Suasana Hati" },
            { id: 30, text: "Menyukai Artistik dan Estetika" },
            { id: 31, text: "Orang Yang Pemalu" },
            { id: 32, text: "Ramah dan Penuh Perhatian" },
            { id: 33, text: "Melakukan Sesuatu Secara Efisien" },
            { id: 34, text: "Tetap Tenang dalam Situasi Tegang" },
            { id: 35, text: "Lebih Suka Bekerja Secara Rutin" },
            { id: 36, text: "Ramah dan Suka Bersosialisasi" },
            { id: 37, text: "Terkadang Kasar Kepada Orang Lain" },
            { id: 38, text: "Membuat Rencana dan Mengikutinya" },
            { id: 39, text: "Mudah Gugup" },
            { id: 40, text: "Suka Merenungkan Sesuatu dan Bermain dengan Ide" },
            { id: 41, text: "Kurang Begitu Antusias" },
            { id: 42, text: "Suka Bekerjasama dengan Orang Lain" },
            { id: 43, text: "Mudah Terganggu" },
            { id: 44, text: "Canggih dalam Seni, Musik atau Sastra" }
        ];

        const scoringMap = {
            'E': { items: [1, 6, 11, 16, 21, 26, 31, 36, 41], reverse: [6, 21, 31, 41] },
            'A': { items: [2, 7, 12, 17, 22, 27, 32, 37, 42], reverse: [2, 12, 27, 37] },
            'C': { items: [3, 8, 13, 18, 23, 28, 33, 38, 43], reverse: [8, 18, 23, 43] },
            'N': { items: [4, 9, 14, 19, 24, 29, 34, 39], reverse: [9, 24, 34] },
            'O': { items: [5, 10, 15, 20, 25, 30, 35, 40, 44], reverse: [35] }
        };

        const interpretations = {
            E: {
                Tinggi: "Memiliki tingkat motivasi yang tinggi dalam bergaul, menjalin hubungan dengan sesama dan dominan dalam lingkungannya.",
                Sedang: "Memiliki keseimbangan antara kecenderungan untuk bersosialisasi dan kebutuhan akan waktu sendiri. Cukup nyaman dalam situasi sosial tetapi juga menghargai kesendirian.",
                Rendah: "Cenderung pendiam, lebih suka menyendiri, dan kurang bersemangat dalam interaksi sosial. Mungkin merasa lebih nyaman dalam lingkungan yang tenang."
            },
            A: {
                Tinggi: "Ramah, memiliki kepribadian yang selalu mengalah, menghindari konflik dan memiliki kecenderungan untuk mengikuti orang lain.",
                Sedang: "Secara umum kooperatif dan ramah, tetapi juga mampu bersikap tegas dan mempertahankan pendapatnya jika diperlukan. Menjaga keseimbangan antara kebutuhan pribadi dan orang lain.",
                Rendah: "Cenderung kompetitif, kritis, dan kurang kooperatif. Mungkin lebih fokus pada kepentingan pribadi daripada menjaga keharmonisan dengan orang lain."
            },
            C: {
                Tinggi: "Memiliki kontrol terhadap lingkungan sosial, berpikir sebelum bertindak, menunda kepuasan, mengikuti peraturan dan norma, terencana, terorganisir, dan memprioritaskan tugas.",
                Sedang: "Cukup terorganisir dan dapat diandalkan, namun juga fleksibel dan tidak terlalu kaku. Mampu menyelesaikan tugas dengan baik sambil tetap bisa beradaptasi dengan perubahan.",
                Rendah: "Cenderung impulsif, tidak terorganisir, dan kurang dapat diandalkan. Mungkin kesulitan dalam membuat rencana jangka panjang dan lebih suka bertindak spontan."
            },
            N: {
                Tinggi: "Memiliki kecenderungan untuk mengalami emosi negatif seperti kecemasan, kemarahan, dan kesedihan. Rentan terhadap stres dan perubahan suasana hati.",
                Sedang: "Memiliki stabilitas emosi yang baik. Mampu mengelola stres dan emosi negatif secara efektif, namun tetap bisa merasakannya dalam situasi yang wajar.",
                Rendah: "Sangat tenang, stabil secara emosional, dan tidak mudah tertekan. Cenderung santai dan mampu menghadapi situasi sulit dengan kepala dingin."
            },
            O: {
                Tinggi: "Mudah bertoleransi, memiliki kapasitas untuk menyerap informasi, menjadi sangat fokus dan mampu untuk waspada pada berbagai perasaan, pemikiran dan impulsivitas.",
                Sedang: "Memiliki keseimbangan antara menghargai hal-hal baru dan tradisional. Terbuka terhadap ide-ide baru namun tetap berpegang pada beberapa rutinitas yang sudah dikenal.",
                Rendah: "Cenderung konvensional, praktis, dan lebih menyukai rutinitas. Mungkin kurang tertarik pada hal-hal abstrak atau ide-ide baru yang radikal."
            }
        };

        // Ganti URL ini dengan URL Web App Google Apps Script Anda
        const GAS_URL = 'https://script.google.com/macros/s/AKfycbzdwauRLxzoeTyFsd-nuByvKKN5a4gPKLMhE-cNP8XSodg2363sR5xrHu966Q0oi7lA/exec';

        document.addEventListener('DOMContentLoaded', () => {
            const welcomePage = document.getElementById('welcome-page');
            const testPage = document.getElementById('test-page');
            const resultPage = document.getElementById('result-page');
            
            const personalDataForm = document.getElementById('personal-data-form');
            const testForm = document.getElementById('test-form');
            const startBtn = document.getElementById('start-test-btn');
            const submitBtn = document.getElementById('submit-btn');

            const consentCheckbox = document.getElementById('consent');
            const formInputs = personalDataForm.querySelectorAll('input, select');
            
            const questionsContainer = document.getElementById('questions-container');
            const loadingSpinner = document.getElementById('loading-spinner');
            const resultContent = document.getElementById('result-content');

            // Fungsi untuk memeriksa validitas form data diri
            function checkFormValidity() {
                let allFilled = true;
                formInputs.forEach(input => {
                    if (input.type !== 'checkbox' && !input.value) {
                        allFilled = false;
                    }
                });
                startBtn.disabled = !(allFilled && consentCheckbox.checked);
            }

            formInputs.forEach(input => input.addEventListener('input', checkFormValidity));
            consentCheckbox.addEventListener('change', checkFormValidity);
            
            // Render Pertanyaan
            function renderQuestions() {
                let questionsHTML = '';
                const options = [
                    { label: 'Sangat Sesuai', value: 5 },
                    { label: 'Sesuai', value: 4 },
                    { label: 'Netral', value: 3 },
                    { label: 'Tidak Sesuai', value: 2 },
                    { label: 'Sangat Tidak Sesuai', value: 1 },
                ];
                
                questions.forEach((q, index) => {
                    questionsHTML += `
                        <div class="question-item">
                            <p class="text-lg font-medium text-gray-800 mb-4">${index + 1}. ${q.text}</p>
                            <div class="flex flex-wrap gap-3 justify-center">`;
                    options.forEach(opt => {
                        questionsHTML += `
                                <div>
                                    <input type="radio" id="q${q.id}_${opt.value}" name="q${q.id}" value="${opt.value}" required>
                                    <label for="q${q.id}_${opt.value}" class="radio-label text-sm md:text-base">${opt.label}</label>
                                </div>`;
                    });
                    questionsHTML += `</div></div>`;
                });
                questionsContainer.innerHTML = questionsHTML;
            }

            renderQuestions();

            // Fitur Gulir Otomatis
            function addAutoScroll() {
                const allRadios = questionsContainer.querySelectorAll('input[type="radio"]');
                allRadios.forEach(radio => {
                    radio.addEventListener('change', (e) => {
                        const currentQuestion = e.target.closest('.question-item');
                        const nextQuestion = currentQuestion.nextElementSibling;
                        
                        // Menunggu sesaat sebelum menggulir agar terasa lebih natural
                        setTimeout(() => {
                            if (nextQuestion) {
                                nextQuestion.scrollIntoView({
                                    behavior: 'smooth',
                                    block: 'center'
                                });
                            }
                        }, 200);
                    });
                });
            }

            addAutoScroll();

            // Event listener untuk memulai tes
            personalDataForm.addEventListener('submit', (e) => {
                e.preventDefault();
                welcomePage.classList.add('hidden');
                testPage.classList.remove('hidden');
            });

            // Event listener untuk submit tes
            testForm.addEventListener('submit', (e) => {
                e.preventDefault();

                // Tampilkan loading
                testPage.classList.add('hidden');
                resultPage.classList.remove('hidden');
                resultContent.classList.add('hidden');
                loadingSpinner.classList.remove('hidden');


                const formData = new FormData(testForm);
                const answers = {};
                for (let [key, value] of formData.entries()) {
                    answers[key.replace('q', '')] = parseInt(value);
                }

                // Kalkulasi Skor
                const scores = { E: 0, A: 0, C: 0, N: 0, O: 0 };
                for (const trait in scoringMap) {
                    let traitScore = 0;
                    scoringMap[trait].items.forEach(itemId => {
                        let score = answers[itemId];
                        if (scoringMap[trait].reverse.includes(itemId)) {
                            score = 6 - score; // Reverse score (1->5, 2->4, etc.)
                        }
                        traitScore += score;
                    });
                    scores[trait] = traitScore;
                }

                // Tentukan level skor & interpretasi
                const scoreLevels = {};
                const finalInterpretations = {};

                // Thresholds - ini adalah estimasi, bisa disesuaikan
                const thresholds = {
                    E: { tinggi: 39, rendah: 28 }, // 9 items * 5 = 45
                    A: { tinggi: 39, rendah: 28 }, // 9 items * 5 = 45
                    C: { tinggi: 39, rendah: 28 }, // 9 items * 5 = 45
                    N: { tinggi: 34, rendah: 23 }, // 8 items * 5 = 40
                    O: { tinggi: 40, rendah: 29 }  // 9 items * 5 = 45
                };

                for (const trait in scores) {
                    if (scores[trait] >= thresholds[trait].tinggi) {
                        scoreLevels[trait] = 'Tinggi';
                    } else if (scores[trait] <= thresholds[trait].rendah) {
                        scoreLevels[trait] = 'Rendah';
                    } else {
                        scoreLevels[trait] = 'Sedang';
                    }
                    finalInterpretations[trait] = interpretations[trait][scoreLevels[trait]];
                }


                // Kumpulkan semua data untuk dikirim
                const personalData = new FormData(personalDataForm);
                const dataToSend = {
                    personalInfo: Object.fromEntries(personalData.entries()),
                    scores: scores,
                    scoreLevels: scoreLevels,
                    interpretations: finalInterpretations
                };
                
                // Kirim data ke Google Apps Script
                fetch(GAS_URL, {
                    method: 'POST',
                    mode: 'no-cors', // Penting untuk menghindari error CORS
                    cache: 'no-cache',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dataToSend),
                    redirect: 'follow',
                })
                .then(response => {
                    console.log('Success (no-cors mode):', response);
                    // Tampilkan halaman hasil setelah beberapa saat
                    setTimeout(() => {
                        loadingSpinner.classList.add('hidden');
                        resultContent.classList.remove('hidden');
                    }, 1500);
                })
                .catch(error => {
                    console.error('Error:', error);
                    // Jika ada error, tetap tampilkan halaman sukses agar user tidak bingung
                    setTimeout(() => {
                        loadingSpinner.classList.add('hidden');
                        resultContent.classList.remove('hidden');
                        resultContent.querySelector('h1').innerText = 'Terjadi Kesalahan';
                        resultContent.querySelector('p').innerText = 'Gagal mengirimkan data. Silakan coba lagi atau hubungi rekruter.';
                    }, 1500);
                });
            });
        });
    </script>
</body>
</html>


